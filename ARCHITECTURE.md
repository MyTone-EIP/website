# ğŸ—ï¸ Architecture - IntÃ©gration API MyTone

## Vue d'ensemble du flux d'authentification

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER INTERACTION                                â”‚
â”‚                                                                     â”‚
â”‚  1. Utilisateur accÃ¨de Ã  /signup ou /login/user                    â”‚
â”‚  2. Remplit le formulaire et soumet                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FRONTEND (Next.js + NextAuth)                         â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ /signup/page.js â”‚          â”‚ /login/user/page.js  â”‚             â”‚
â”‚  â”‚                 â”‚          â”‚                      â”‚             â”‚
â”‚  â”‚ - Form submit   â”‚          â”‚ - useAuth hook       â”‚             â”‚
â”‚  â”‚ - Validation    â”‚          â”‚ - Appel login()      â”‚             â”‚
â”‚  â”‚ - Appel API     â”‚          â”‚ - Redirection        â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚           â”‚                              â”‚                         â”‚
â”‚           â”‚ POST /api/signup             â”‚ signIn('credentials')   â”‚
â”‚           â–¼                              â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚   NextAuth Provider (Credentials)            â”‚                 â”‚
â”‚  â”‚   /app/api/auth/[...nextauth]/route.js       â”‚                 â”‚
â”‚  â”‚                                              â”‚                 â”‚
â”‚  â”‚   Appelle l'API backend pour authentifier    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ RequÃªte API JSON
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BACKEND API (FastAPI + SQLAlchemy)                    â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  POST /auth/register                         â”‚                 â”‚
â”‚  â”‚  - Valide les donnÃ©es                        â”‚                 â”‚
â”‚  â”‚  - Hash le password (bcrypt)                 â”‚                 â”‚
â”‚  â”‚  - CrÃ©e l'utilisateur en BDD                â”‚                 â”‚
â”‚  â”‚  - GÃ©nÃ¨re JWT tokens                         â”‚                 â”‚
â”‚  â”‚  - Retourne: user + tokens                   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  POST /auth/login                           â”‚                 â”‚
â”‚  â”‚  - Cherche l'utilisateur par email/username â”‚                 â”‚
â”‚  â”‚  - VÃ©rifie le password                       â”‚                 â”‚
â”‚  â”‚  - GÃ©nÃ¨re JWT tokens                         â”‚                 â”‚
â”‚  â”‚  - Retourne: access_token + refresh_token   â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  GET /auth/me (avec Bearer token)           â”‚                 â”‚
â”‚  â”‚  - VÃ©rifie le JWT                           â”‚                 â”‚
â”‚  â”‚  - Retourne: donnÃ©es utilisateur             â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚  DATABASE (PostgreSQL)                       â”‚                 â”‚
â”‚  â”‚  - Table USERS                               â”‚                 â”‚
â”‚  â”‚  - Table TOKENS (refresh tokens)             â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ RÃ©ponse API JSON
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FRONTEND (Suite)                                       â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  NextAuth JWT Callback                     â”‚                   â”‚
â”‚  â”‚  - ReÃ§oit user + tokens                    â”‚                   â”‚
â”‚  â”‚  - Stocke dans token JWT                   â”‚                   â”‚
â”‚  â”‚  - CrÃ©e session sÃ©curisÃ©e                  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Session stockÃ©e dans:                     â”‚                   â”‚
â”‚  â”‚  - NextAuth internal storage               â”‚                   â”‚
â”‚  â”‚  - Accessible via useSession()             â”‚                   â”‚
â”‚  â”‚  - Cookies HttpOnly (Production)           â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                    â”‚
â”‚  Utilisateur peut maintenant:                                     â”‚
â”‚  - AccÃ©der aux routes protÃ©gÃ©es                                  â”‚
â”‚  - Utiliser useAuth() pour les donnÃ©es                           â”‚
â”‚  - Faire des appels API authentifiÃ©s                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Architecture des fichiers

```
website/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â””â”€â”€ [...nextauth]/
â”‚   â”‚   â”‚       â””â”€â”€ route.js â­ MODIFIÃ‰ - Utilise l'API backend
â”‚   â”‚   â””â”€â”€ signup/
â”‚   â”‚       â””â”€â”€ route.js âœ… Utilise dÃ©jÃ  l'API backend
â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ user/
â”‚   â”‚       â””â”€â”€ page.js
â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â””â”€â”€ page.js
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ db.js (anciennes fonctions SQL)
â”‚   â”œâ”€â”€ api.js â­ CRÃ‰Ã‰ - Utilitaire API
â”‚   â””â”€â”€ s3.js
â”‚
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useAuth.js â­ CRÃ‰Ã‰ - Hook React pour auth
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ LanguageSelector.js
â”‚   â””â”€â”€ ExampleAuthComponent.js â­ CRÃ‰Ã‰ - Exemples d'utilisation
â”‚
â”œâ”€â”€ middleware.js â­ CRÃ‰Ã‰ - Routes protÃ©gÃ©es
â”œâ”€â”€ .env.local.example â­ CRÃ‰Ã‰ - Configuration exemple
â”œâ”€â”€ API_INTEGRATION.md â­ CRÃ‰Ã‰ - Documentation
â”œâ”€â”€ TROUBLESHOOTING.md â­ CRÃ‰Ã‰ - Guide dÃ©pannage
â”œâ”€â”€ SETUP_CHECKLIST.md â­ CRÃ‰Ã‰ - Checklist
â””â”€â”€ DASHBOARD_EXAMPLE.js â­ CRÃ‰Ã‰ - Exemple dashboard
```

## Flux des donnÃ©es - Exemple complet

### 1ï¸âƒ£ Inscription

```
User Form Input:
{
  name: "Jean",
  surname: "Dupont",
  email: "jean@example.com",
  username: "jeandupont",
  password: "SuperSecure123!"
}
      â”‚
      â–¼ POST /api/signup
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend API Route Handler               â”‚
â”‚ /app/api/signup/route.js                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼ POST https://api-mytone.onrender.com/auth/register
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend - Create User                    â”‚
â”‚ - Hash password                          â”‚
â”‚ - Save to Database                       â”‚
â”‚ - Generate JWT tokens                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼ Response
{
  "user": {
    "id": 123,
    "name": "Jean",
    "email": "jean@example.com",
    ...
  },
  "access_token": "eyJhbGc...",
  "refresh_token": "eyJhbGc...",
  "token_type": "bearer"
}
      â”‚
      â–¼ Frontend receives & auto-connects
      â”‚
      â–¼ signIn('credentials', {...})
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NextAuth Authenticate                    â”‚
â”‚ - Fetch user data with token             â”‚
â”‚ - Store tokens in session                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼ Redirect to /
User is now logged in âœ…
```

### 2ï¸âƒ£ Connexion

```
User Credentials:
{
  identifier: "jean@example.com",
  password: "SuperSecure123!"
}
      â”‚
      â–¼ signIn('credentials', {...})
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NextAuth Provider                        â”‚
â”‚ /app/api/auth/[...nextauth]/route.js    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼ POST https://api-mytone.onrender.com/auth/login
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend - Authenticate User              â”‚
â”‚ - Find user by email/username            â”‚
â”‚ - Verify password                        â”‚
â”‚ - Generate new tokens                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼ Response
{
  "access_token": "eyJhbGc...",
  "refresh_token": "eyJhbGc...",
  "token_type": "bearer"
}
      â”‚
      â–¼ Fetch user data with token
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /auth/me (with Bearer token)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼ Response
{
  "id": 123,
  "name": "Jean",
  "email": "jean@example.com",
  "username": "jeandupont",
  ...
}
      â”‚
      â–¼ Store in JWT + Session
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NextAuth Session                         â”‚
â”‚ {                                        â”‚
â”‚   user: {...},                           â”‚
â”‚   accessToken: "...",                    â”‚
â”‚   refreshToken: "..."                    â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â–¼ Redirect to dashboard
User is logged in âœ…
```

### 3ï¸âƒ£ AccÃ¨s aux routes protÃ©gÃ©es

```
User requests /dashboard
      â”‚
      â–¼ Middleware check
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Middleware (/middleware.js)              â”‚
â”‚ - Get JWT token                          â”‚
â”‚ - Verify token exists                    â”‚
â”‚ - Check route protection                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
   â”Œâ”€â”€â”´â”€â”€â”
   â”‚     â”‚
Has Token? No â†’ Redirect to /login/user âŒ
   â”‚
  Yes
   â”‚
   â–¼
Allow access âœ…
      â”‚
      â–¼
Component renders & accesses user data
via useAuth() hook
```

## SÃ©curitÃ© - Flux des tokens

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TOKEN LIFECYCLE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. Backend gÃ©nÃ¨re tokens lors de login/register          â”‚
â”‚     - Access Token: Valide 15-30 min                      â”‚
â”‚     - Refresh Token: Valide 7-30 jours                    â”‚
â”‚                                                             â”‚
â”‚  2. Frontend stocke via NextAuth                          â”‚
â”‚     - DÃ©veloppement: LocalStorage (httpOnly simulÃ©)      â”‚
â”‚     - Production: Cookies HttpOnly (sÃ©curisÃ©)            â”‚
â”‚                                                             â”‚
â”‚  3. NextAuth gÃ¨re les appels API                          â”‚
â”‚     - Inclut automatiquement Bearer token                 â”‚
â”‚     - DÃ©tecte expiration                                  â”‚
â”‚     - Appelle /auth/refresh automatiquement               â”‚
â”‚                                                             â”‚
â”‚  4. Composants accÃ¨dent via useAuth()                     â”‚
â”‚     - getAccessToken() - Short-lived                      â”‚
â”‚     - getRefreshToken() - Long-lived                      â”‚
â”‚                                                             â”‚
â”‚  5. Logout supprime les tokens                            â”‚
â”‚     - Appelle /auth/logout                               â”‚
â”‚     - Efface la session NextAuth                          â”‚
â”‚     - Redirige vers /login                               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## DÃ©pendances requises

```json
{
  "dependencies": {
    "next": "^14.0.0 ou plus",
    "next-auth": "^4.24.0 ou plus",
    "react": "^18.0.0 ou plus",
    "react-dom": "^18.0.0 ou plus",
    "bcryptjs": "^2.4.3 ou plus"
  }
}
```

---

Cette architecture assure une authentification sÃ©curisÃ©e entre votre frontend Next.js et votre backend FastAPI, avec une gestion complÃ¨te des tokens JWT et des sessions utilisateur.
